!function(){"use strict";var e="";const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},r=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},o=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?n(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},n=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},a=e=>{document.querySelectorAll(e.formSelector).forEach((t=>{((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);o(n,a,t),n.forEach((l=>{l.addEventListener("input",(function(){((e,t,o)=>{t.validity.valid?r(e,t,o):((e,t,r,o)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(o.inputErrorClass)})(e,t,t.validationMessage,o)})(e,l,t),o(n,a,t)}))}))})(t,e)}))};a(t);function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Save",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Saving...";e.textContent=t?o:r}var s=e+"d3610e9c6dce3cb370d8.svg";document.getElementById("header__logo").src=s;const c=document.getElementById("profile__avatar");let i,d;const u=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}editAvatarInfo(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}addCard(e){let{name:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}toggleLike(e,t){const r=t?"DELETE":"PUT";return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:r,headers:this._headers}).then((e=>{if(e.ok)return e.json();Promise.reject(`Error: ${e.status}`)}))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"138fe482-aa90-46db-b20b-613bcdba9e47","Content-Type":"application/json"}});u.getAppInfo().then((e=>{let[t,r]=e;console.log(t),console.log(r),t.forEach((e=>{const t=M(e);z.prepend(t)})),c.src=r.avatar,document.querySelector(".profile__name").textContent=r.name,document.querySelector(".profile__description").textContent=r.about}));const m=document.querySelector(".profile__edit-btn"),_=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),f=document.querySelector(".profile__add-btn"),v=document.querySelector(".profile__avatar-btn"),y=document.querySelector("#avatar-modal"),b=y.querySelector(".modal__form"),S=y.querySelector(".modal__submit-btn"),p=y.querySelector(".modal__close-btn"),q=y.querySelector("#profile-avatar-input"),E=document.querySelector("#delete-modal"),k=E.querySelector(".modal__form"),g=E.querySelector(".modal__close-btn"),L=E.querySelectorAll(".modal__submit-btn")[1],C=document.querySelector("#edit-profile-modal"),$=C.querySelector(".modal__form"),j=C.querySelector(".modal__close-btn"),U=C.querySelector("#profile-name-input"),I=C.querySelector("#profile-description-input"),P=document.querySelector("#add-card-modal"),x=P.querySelector(".modal__form"),A=P.querySelector(".modal__submit-btn"),D=P.querySelector(".modal__close-btn"),B=P.querySelector("#add-card-name-input"),T=P.querySelector("#add-card-link-input"),w=document.querySelector("#preview-modal"),N=w.querySelector(".modal__image"),O=w.querySelector(".modal__title"),J=w.querySelector(".modal__close-btn"),H=document.querySelector("#card__template"),z=document.querySelector(".cards__list");function M(e){const t=H.content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return 1==e.isLiked&&n.classList.add("card__like-btn_liked"),r.textContent=e.name,o.src=e.link,o.alt=e.name,n.addEventListener("click",(t=>function(e,t){const r=e.target.classList.contains("card__like-btn_liked");u.toggleLike(t,r).then((t=>{e.target.classList.toggle("card__like-btn_liked")})).catch((e=>console.log(e)))}(t,e._id))),a.addEventListener("click",(r=>function(e,t){i=e,d=t,F(E)}(t,e._id))),o.addEventListener("click",(()=>{F(w),O.textContent=e.name,N.src=e.link,N.alt=e.name})),t}function F(e){e.classList.add("modal_opened"),e.addEventListener("click",K),document.addEventListener("keydown",Q)}function G(e){e.classList.remove("modal_opened"),e.removeEventListener("click",K),document.removeEventListener("keydown",Q)}function K(e){e.target.classList.contains("modal")&&G(e.target)}function Q(e){"Escape"===e.key&&G(document.querySelector(".modal_opened"))}m.addEventListener("click",(()=>{var e,o;U.value=_.textContent,I.value=h.textContent,e=$,o=t,[U,I].forEach((t=>{r(e,t,o)})),F(C)})),j.addEventListener("click",(()=>{G(C)})),f.addEventListener("click",(()=>{F(P)})),D.addEventListener("click",(()=>{G(P)})),J.addEventListener("click",(()=>{G(w)})),v.addEventListener("click",(()=>{F(y)})),p.addEventListener("click",(()=>{G(y)})),g.addEventListener("click",(()=>{G(E)})),L.addEventListener("click",(()=>{G(E)})),$.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;l(t,!0),u.editUserInfo({name:U.value,about:I.value}).then((e=>{_.textContent=e.name,h.textContent=e.about,G(C)})).catch((e=>console.log(e))).finally((()=>{l(t,!1)}))})),x.addEventListener("submit",(function(e){e.preventDefault();const r=e.submitter;l(r,!0),u.addCard({name:B.value,link:T.value}).then((r=>{const o=M(r);z.prepend(o),e.target.reset(),n(A,t),G(P)})).catch((e=>console.log(e))).finally((()=>{l(r,!1)}))})),b.addEventListener("submit",(function(e){e.preventDefault();const r=e.submitter;l(r,!0),u.editAvatarInfo(q.value).then((r=>{c.src=r.avatar,e.target.reset(),n(S,t),G(y)})).catch((e=>console.log(e))).finally((()=>{l(r,!1)}))})),k.addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;l(t,!0,"Delete","Deleting..."),u.deleteCard(d).then((()=>{i.remove(),G(E)})).catch(console.error).finally((()=>{l(t,!1,"Delete","Deleting...")}))})),a(t)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU8sU0FBVSxjQUFjLEdBRTlELElBNkRBdEksRUFBaUI1QixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzL3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvaGVscGVycy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCJfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiOyIsImV4cG9ydCBjb25zdCBzZXR0aW5ncyA9IHtcclxuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXHJcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ0bl9kaXNhYmxlZFwiLFxyXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxyXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcclxufTtcclxuXHJcbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FTCwgaW5wdXRFTCwgZXJyb3JNc2csIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRUwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFTC5pZH0tZXJyb3JgKTtcclxuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gZXJyb3JNc2c7XHJcbiAgaW5wdXRFTC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xyXG59O1xyXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRUwsIGlucHV0RUwsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRUwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFTC5pZH0tZXJyb3JgKTtcclxuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gXCJcIjtcclxuICBpbnB1dEVMLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbn07XHJcbmNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykgPT4ge1xyXG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBpbnB1dEVsLnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XHJcbiAgfVxyXG59O1xyXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XHJcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xyXG4gICAgcmV0dXJuICFpbnB1dC52YWxpZGl0eS52YWxpZDtcclxuICB9KTtcclxufTtcclxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSA9PiB7XHJcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XHJcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsLCBjb25maWcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b25FbC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uLCBjb25maWcpID0+IHtcclxuICBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xyXG4gIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxufTtcclxuXHJcbi8vb3B0aW9uYWxcclxuZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWwsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XHJcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0LCBjb25maWcpO1xyXG4gIH0pO1xyXG59O1xyXG5jb25zdCBzZXRFdmVudExpc3RlbmVycyA9IChmb3JtRWwsIGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XHJcbiAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xyXG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHtcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKTtcclxuICB9KTtcclxufTtcclxuXHJcbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xyXG4iLCJleHBvcnQgZnVuY3Rpb24gc2V0QnV0dG9uVGV4dChcclxuICBidG4sXHJcbiAgaXNMb2FkaW5nLFxyXG4gIGRlZmF1bHRUZXh0ID0gXCJTYXZlXCIsXHJcbiAgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiXHJcbikge1xyXG4gIGlmIChpc0xvYWRpbmcpIHtcclxuICAgIC8vc2V0IGxvYWRpbmcgdGV4dFxyXG4gICAgYnRuLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vc2V0IGRlZmF1bHQgdGV4dFxyXG4gICAgYnRuLnRleHRDb250ZW50ID0gZGVmYXVsdFRleHQ7XHJcbiAgfVxyXG59XHJcbiIsIi8vMTM4ZmU0ODItYWE5MC00NmRiLWIyMGItNjEzYmNkYmE5ZTQ3XHJcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCB7XHJcbiAgZW5hYmxlVmFsaWRhdGlvbixcclxuICBzZXR0aW5ncyxcclxuICByZXNldFZhbGlkYXRpb24sXHJcbiAgZGlzYWJsZUJ1dHRvbixcclxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XHJcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xyXG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcclxuXHJcbi8vIEltcG9ydCB0aGUgaW1hZ2VcclxuaW1wb3J0IGxvZ28gZnJvbSBcIi4uL2ltYWdlcy9sb2dvLnN2Z1wiO1xyXG5pbXBvcnQgYXZhdGFyIGZyb20gXCIuLi9pbWFnZXMvYXZhdGFyLmpwZ1wiO1xyXG5cclxuLy8gU2VsZWN0IHRoZSBlbGVtZW50IGFuZCBzZXQgdGhlIHNyY1xyXG5jb25zdCBoZWFkZXJMb2dvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJoZWFkZXJfX2xvZ29cIik7XHJcbmhlYWRlckxvZ28uc3JjID0gbG9nbztcclxuXHJcbmNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInByb2ZpbGVfX2F2YXRhclwiKTtcclxubGV0IHNlbGVjdGVkQ2FyZDtcclxubGV0IHNlbGVjdGVkQ2FyZElkO1xyXG5cclxuY29uc3QgYXBpID0gbmV3IEFwaSh7XHJcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IFwiMTM4ZmU0ODItYWE5MC00NmRiLWIyMGItNjEzYmNkYmE5ZTQ3XCIsXHJcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICB9LFxyXG59KTtcclxuLy9kZXN0cnVjdHVyZSB0aGUgc2Vjb25kIGl0ZW0gaW4gdGhlIGNhbGxiYWNrIG9mIHRoZSAudGhlbigpXHJcbmFwaS5nZXRBcHBJbmZvKCkudGhlbigoW2NhcmRzLCB1c2Vyc10pID0+IHtcclxuICBjb25zb2xlLmxvZyhjYXJkcyk7XHJcbiAgY29uc29sZS5sb2codXNlcnMpO1xyXG4gIGNhcmRzLmZvckVhY2goKGl0ZW0pID0+IHtcclxuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoaXRlbSk7XHJcbiAgICBjYXJkc0xpc3QucHJlcGVuZChjYXJkRWxlbWVudCk7XHJcbiAgfSk7XHJcblxyXG4gIC8vaGFuZGxlIHRoZSB1c2VycyBpbmZvcm1hdGlvblxyXG4gIC8vc2V0IHRoZSBzcmMgb2YgYXZhdGFyIGltZ1xyXG4gIHByb2ZpbGVBdmF0YXIuc3JjID0gdXNlcnMuYXZhdGFyO1xyXG4gIC8vc2V0IHRleHRDb250ZW50IG9mIGJvdGggdGhlIHRleHQgZWxlbWVudHNcclxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIikudGV4dENvbnRlbnQgPSB1c2Vycy5uYW1lO1xyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIikudGV4dENvbnRlbnQgPSB1c2Vycy5hYm91dDtcclxufSk7XHJcblxyXG4vL1Byb2ZpbGUgRWxlbWVudHNcclxuY29uc3QgcHJvZmlsZUVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xyXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcclxuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcclxuY29uc3QgY2FyZE1vZGFsQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuXCIpO1xyXG5jb25zdCBhdmF0YXJNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcclxuXHJcbi8vQXZhdGFyIE1vZGFsXHJcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhdmF0YXItbW9kYWxcIik7XHJcbmNvbnN0IGF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBhdmF0YXJTdWJtaXRCdG4gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xyXG5jb25zdCBhdmF0YXJNb2RhbENsb3NlQnRuID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hdmF0YXItaW5wdXRcIik7XHJcblxyXG4vL0RlbGV0ZSBGb3JtIEVsZW1lbnRzXHJcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtbW9kYWxcIik7XHJcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBkZWxldGVNb2RhbENsb3NlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xyXG5jb25zdCBkZWxldGVDYW5jZWxCdG4gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpWzFdO1xyXG5cclxuLy9FZGl0IFByb2ZpbGUgTW9kYWxcclxuY29uc3QgZWRpdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XHJcbmNvbnN0IGVkaXRGb3JtRWxlbWVudCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBlZGl0TW9kYWxDbG9zZUJ0biA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XHJcbmNvbnN0IGVkaXRNb2RhbE5hbWVJbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcclxuY29uc3QgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxyXG4pO1xyXG5cclxuLy9BZGQgQ2FyZCBNb2RhbFxyXG5jb25zdCBjYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW1vZGFsXCIpO1xyXG5jb25zdCBjYXJkRm9ybSA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xyXG5jb25zdCBjYXJkU3VibWl0QnRuID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XHJcbmNvbnN0IGNhcmRNb2RhbENsb3NlQnRuID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcclxuY29uc3QgY2FyZE5hbWVJbnB1dCA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2FkZC1jYXJkLW5hbWUtaW5wdXRcIik7XHJcbmNvbnN0IGNhcmRMaW5rSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1saW5rLWlucHV0XCIpO1xyXG5cclxuLy9QcmV2aWV3IENhcmQgTW9kYWxcclxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xyXG5jb25zdCBwcmV2aWV3TW9kYWxJbWFnZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG5jb25zdCBwcmV2aWV3TW9kYWxUaXRsZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3RpdGxlXCIpO1xyXG5jb25zdCBwcmV2aWV3TW9kYWxDbG9zZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcclxuXHJcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZF9fdGVtcGxhdGVcIik7XHJcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XHJcblxyXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY29udGVudFxyXG4gICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxyXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcclxuXHJcbiAgY29uc3QgY2FyZE5hbWVFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XHJcbiAgY29uc3QgY2FyZEltYWdlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xyXG4gIGNvbnN0IGNhcmRMaWtlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ0blwiKTtcclxuICBjb25zdCBjYXJkRGVsZXRlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xyXG5cclxuICBpZiAoZGF0YS5pc0xpa2VkID09IHRydWUpIHtcclxuICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcclxuICB9XHJcblxyXG4gIGNhcmROYW1lRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xyXG4gIGNhcmRJbWFnZUVsLmFsdCA9IGRhdGEubmFtZTtcclxuXHJcbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IGhhbmRsZUxpa2UoZXZ0LCBkYXRhLl9pZCkpO1xyXG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+XHJcbiAgICBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhLl9pZClcclxuICApO1xyXG4gIGNhcmRJbWFnZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcclxuICAgIHByZXZpZXdNb2RhbFRpdGxlRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgICBwcmV2aWV3TW9kYWxJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcclxuICAgIHByZXZpZXdNb2RhbEltYWdlRWwuYWx0ID0gZGF0YS5uYW1lO1xyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XHJcbn1cclxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcclxuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2xvc2VNb2RhbEJ5T3ZlcmxheSk7XHJcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VNb2RhbEJ5RXNjKTtcclxufVxyXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XHJcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcclxuICBtb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2xvc2VNb2RhbEJ5T3ZlcmxheSk7XHJcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VNb2RhbEJ5RXNjKTtcclxufVxyXG5mdW5jdGlvbiBjbG9zZU1vZGFsQnlPdmVybGF5KGV2dCkge1xyXG4gIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsXCIpKSB7XHJcbiAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xyXG4gIH1cclxufVxyXG5mdW5jdGlvbiBjbG9zZU1vZGFsQnlFc2MoZXZ0KSB7XHJcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcclxuICAgIGNvbnN0IG1vZGFsT3BlbmVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9vcGVuZWRcIik7XHJcbiAgICBjbG9zZU1vZGFsKG1vZGFsT3BlbmVkKTtcclxuICB9XHJcbn1cclxuZnVuY3Rpb24gaGFuZGxlRWRpdEZvcm1TdWJtaXQoZXZ0KSB7XHJcbiAgLy8gUHJldmVudCBkZWZhdWx0IGJyb3dzZXIgYmVoYXZpb3JcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICAvL2NoYW5nZSB0ZXh0IGNvbnRlbnQgdG8gc2F2aW5nLi4uXHJcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcclxuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSk7XHJcblxyXG4gIGFwaVxyXG4gICAgLmVkaXRVc2VySW5mbyh7XHJcbiAgICAgIG5hbWU6IGVkaXRNb2RhbE5hbWVJbnB1dC52YWx1ZSxcclxuICAgICAgYWJvdXQ6IGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUsXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XHJcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XHJcbiAgICAgIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgLy9jaGFuZ2UgdGV4dCBjb250ZW50IGJhY2sgdG8gc2F2ZVxyXG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8vVE9ETyBpbXBsZW1lbnQgbG9hZGluZyB0ZXh0IGZvciBhbGwgb3RoZXIgZm9ybSBzdWJtaXNzaW9uc1xyXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XHJcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xyXG4gIGFwaVxyXG4gICAgLmFkZENhcmQoeyBuYW1lOiBjYXJkTmFtZUlucHV0LnZhbHVlLCBsaW5rOiBjYXJkTGlua0lucHV0LnZhbHVlIH0pXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBjYXJkRWwgPSBnZXRDYXJkRWxlbWVudChkYXRhKTtcclxuICAgICAgLy9wcmVwZW5kIG9yIGFwcGVuZD8gUGVyc29uYWxseSBpIGxpa2UgYXBwZW5kIGJ1dCBJJ2xsIGtlZXAgYXMgaXNcclxuICAgICAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsKTtcclxuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xyXG4gICAgICBkaXNhYmxlQnV0dG9uKGNhcmRTdWJtaXRCdG4sIHNldHRpbmdzKTtcclxuICAgICAgY2xvc2VNb2RhbChjYXJkTW9kYWwpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgY2FyZElkKSB7XHJcbiAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XHJcbiAgc2VsZWN0ZWRDYXJkSWQgPSBjYXJkSWQ7XHJcbiAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcclxufVxyXG5mdW5jdGlvbiBoYW5kbGVMaWtlKGV2dCwgY2FyZElkKSB7XHJcbiAgY29uc3QgaXNMaWtlZCA9IGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XHJcbiAgYXBpXHJcbiAgICAudG9nZ2xlTGlrZShjYXJkSWQsIGlzTGlrZWQpXHJcbiAgICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbn1cclxuXHJcbi8vIFRoZSBzdWJtaXNzaW9uIGhhbmRsZXIgbWFrZXMgdXNlIG9mIHRoZSBzZWxlY3RlZENhcmQgYW5kIHNlbGVjdGVkQ2FyZElkXHJcbi8vIHZhcmlhYmxlcyB0byB0YXJnZXQgdGhlIGNvcnJlY3QgY2FyZC5cclxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XHJcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XHJcbiAgYXBpXHJcbiAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZCkgLy8gcGFzcyB0aGUgSUQgdGhlIHRoZSBhcGkgZnVuY3Rpb25cclxuICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgLy8gcmVtb3ZlIHRoZSBjYXJkIGZyb20gdGhlIERPTSBhbmQgdGhlbiBjbG9zZSBtb2RhbFxyXG4gICAgICBzZWxlY3RlZENhcmQucmVtb3ZlKCk7XHJcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UsIFwiRGVsZXRlXCIsIFwiRGVsZXRpbmcuLi5cIik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyU3VibWl0KGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XHJcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xyXG4gIGFwaVxyXG4gICAgLmVkaXRBdmF0YXJJbmZvKGF2YXRhcklucHV0LnZhbHVlKVxyXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcclxuICAgICAgcHJvZmlsZUF2YXRhci5zcmMgPSBkYXRhLmF2YXRhcjtcclxuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xyXG4gICAgICBkaXNhYmxlQnV0dG9uKGF2YXRhclN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xyXG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIGZhbHNlKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5wcm9maWxlRWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGVkaXRNb2RhbE5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lLnRleHRDb250ZW50O1xyXG4gIGVkaXRNb2RhbERlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQ7XHJcbiAgcmVzZXRWYWxpZGF0aW9uKFxyXG4gICAgZWRpdEZvcm1FbGVtZW50LFxyXG4gICAgW2VkaXRNb2RhbE5hbWVJbnB1dCwgZWRpdE1vZGFsRGVzY3JpcHRpb25JbnB1dF0sXHJcbiAgICBzZXR0aW5nc1xyXG4gICk7XHJcbiAgb3Blbk1vZGFsKGVkaXRNb2RhbCk7XHJcbn0pO1xyXG5lZGl0TW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcclxufSk7XHJcbmNhcmRNb2RhbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIG9wZW5Nb2RhbChjYXJkTW9kYWwpO1xyXG59KTtcclxuY2FyZE1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKGNhcmRNb2RhbCk7XHJcbn0pO1xyXG5wcmV2aWV3TW9kYWxDbG9zZUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpO1xyXG59KTtcclxuXHJcbmF2YXRhck1vZGFsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcclxufSk7XHJcbmF2YXRhck1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcclxufSk7XHJcbmRlbGV0ZU1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKTtcclxufSk7XHJcbmRlbGV0ZUNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xyXG59KTtcclxuXHJcbmVkaXRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcclxuY2FyZEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRDYXJkU3VibWl0KTtcclxuYXZhdGFyRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XHJcbmRlbGV0ZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVTdWJtaXQpO1xyXG5cclxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XHJcbiIsImNsYXNzIEFwaSB7XHJcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcclxuICAgIC8vIGNvbnN0cnVjdG9yIGJvZHlcclxuICAgIHRoaXMuX2Jhc2VVcmwgPSBiYXNlVXJsO1xyXG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XHJcbiAgfVxyXG5cclxuICBnZXRBcHBJbmZvKCkge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcclxuICB9XHJcbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvLyBvdGhlciBtZXRob2RzIGZvciB3b3JraW5nIHdpdGggdGhlIEFQSVxyXG4gIGdldFVzZXJJbmZvKCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAvLyBQYXNzIHRoZSBkYXRhIGFzIGFuIGFyZ3VtZW50LiBJbiB0aGlzIGV4YW1wbGUsIHdlIGFyZSB1c2luZyBkZXN0cnVjdHVyaW5nLFxyXG4gIC8vIHNvIHdlIHdvdWxkIG5lZWQgdG8gcGFzcyB0aGUgZnVuY3Rpb24gYW4gb2JqZWN0IHdpdGggcHJvcGVydGllcyBjYWxsZWRcclxuICAvLyBuYW1lIGFuZCBhYm91dC5cclxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxyXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxyXG4gICAgICAvLyBTZW5kIHRoZSBkYXRhIGluIHRoZSBib2R5IGFzIGEgSlNPTiBzdHJpbmcuXHJcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBuYW1lLFxyXG4gICAgICAgIGFib3V0LFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgZWRpdEF2YXRhckluZm8oYXZhdGFyKSB7XHJcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgYXZhdGFyLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgLy9JbXBsZW1lbnQgUE9TVC9jYXJkc1xyXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcclxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBsaW5rLFxyXG4gICAgICB9KSxcclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgZGVsZXRlQ2FyZChpZCkge1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9YCwge1xyXG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXHJcbiAgICAgIC8vIFNlbmQgdGhlIGRhdGEgaW4gdGhlIGJvZHkgYXMgYSBKU09OIHN0cmluZy5cclxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICBpZiAocmVzLm9rKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgICAgIH1cclxuICAgICAgUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgdG9nZ2xlTGlrZShpZCwgaXNMaWtlZCkge1xyXG4gICAgY29uc3QgbWV0aG9kID0gaXNMaWtlZCA/IFwiREVMRVRFXCIgOiBcIlBVVFwiO1xyXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xyXG4gICAgICBtZXRob2Q6IG1ldGhvZCxcclxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcclxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxyXG4gICAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICAgIGlmIChyZXMub2spIHtcclxuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgfVxyXG4gICAgICBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLy8gZXhwb3J0IHRoZSBjbGFzc1xyXG5leHBvcnQgZGVmYXVsdCBBcGk7XHJcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVMIiwiaW5wdXRFTCIsImNvbmZpZyIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbCIsInNvbWUiLCJpbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJidXR0b24iLCJhZGQiLCJlbmFibGVWYWxpZGF0aW9uIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImZvcm1FbCIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIiwiYnV0dG9uRWxlbWVudCIsImlucHV0RWxlbWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJpbnB1dEVsIiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1zZyIsInZhbGlkYXRpb25NZXNzYWdlIiwic2V0QnV0dG9uVGV4dCIsImJ0biIsImlzTG9hZGluZyIsImRlZmF1bHRUZXh0IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwibG9hZGluZ1RleHQiLCJnZXRFbGVtZW50QnlJZCIsInNyYyIsImxvZ28iLCJwcm9maWxlQXZhdGFyIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsImVkaXRVc2VySW5mbyIsIl9yZWYyIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0QXZhdGFySW5mbyIsImF2YXRhciIsImFkZENhcmQiLCJfcmVmMyIsImxpbmsiLCJkZWxldGVDYXJkIiwidG9nZ2xlTGlrZSIsImlzTGlrZWQiLCJhdXRob3JpemF0aW9uIiwiY2FyZHMiLCJ1c2VycyIsImNvbnNvbGUiLCJsb2ciLCJpdGVtIiwiY2FyZEVsZW1lbnQiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRzTGlzdCIsInByZXBlbmQiLCJwcm9maWxlRWRpdEJ0biIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwiY2FyZE1vZGFsQnRuIiwiYXZhdGFyTW9kYWxCdG4iLCJhdmF0YXJNb2RhbCIsImF2YXRhckZvcm0iLCJhdmF0YXJTdWJtaXRCdG4iLCJhdmF0YXJNb2RhbENsb3NlQnRuIiwiYXZhdGFySW5wdXQiLCJkZWxldGVNb2RhbCIsImRlbGV0ZUZvcm0iLCJkZWxldGVNb2RhbENsb3NlQnRuIiwiZGVsZXRlQ2FuY2VsQnRuIiwiZWRpdE1vZGFsIiwiZWRpdEZvcm1FbGVtZW50IiwiZWRpdE1vZGFsQ2xvc2VCdG4iLCJlZGl0TW9kYWxOYW1lSW5wdXQiLCJlZGl0TW9kYWxEZXNjcmlwdGlvbklucHV0IiwiY2FyZE1vZGFsIiwiY2FyZEZvcm0iLCJjYXJkU3VibWl0QnRuIiwiY2FyZE1vZGFsQ2xvc2VCdG4iLCJjYXJkTmFtZUlucHV0IiwiY2FyZExpbmtJbnB1dCIsInByZXZpZXdNb2RhbCIsInByZXZpZXdNb2RhbEltYWdlRWwiLCJwcmV2aWV3TW9kYWxUaXRsZUVsIiwicHJldmlld01vZGFsQ2xvc2VFbCIsImNhcmRUZW1wbGF0ZSIsImRhdGEiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZE5hbWVFbCIsImNhcmRJbWFnZUVsIiwiY2FyZExpa2VCdG4iLCJjYXJkRGVsZXRlQnRuIiwiYWx0IiwiZXZ0IiwiY2FyZElkIiwidGFyZ2V0IiwiY29udGFpbnMiLCJ0b2dnbGUiLCJjYXRjaCIsImVyciIsImhhbmRsZUxpa2UiLCJfaWQiLCJvcGVuTW9kYWwiLCJoYW5kbGVEZWxldGVDYXJkIiwibW9kYWwiLCJjbG9zZU1vZGFsQnlPdmVybGF5IiwiY2xvc2VNb2RhbEJ5RXNjIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJrZXkiLCJyZXNldFZhbGlkYXRpb24iLCJ2YWx1ZSIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0QnRuIiwic3VibWl0dGVyIiwiZmluYWxseSIsImNhcmRFbCIsInJlc2V0IiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9